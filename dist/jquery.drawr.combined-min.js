!function(t){t.fn.drawr=function(o,e){var a=this;if(a.distance_between=function(t,o){return Math.sqrt(Math.pow(o.x-t.x,2)+Math.pow(o.y-t.y,2))},a.angle_between=function(t,o){return Math.atan2(o.x-t.x,o.y-t.y)},a.hex_to_rgb=function(t){var o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:null},a.get_mouse_data=function(t,o,e){if(null!=o)var a=parseInt(window.getComputedStyle(o,null).getPropertyValue("border-top-width")),r=parseInt(window.getComputedStyle(o,null).getPropertyValue("border-left-width")),i=void 0!==e?e.scrollX:0,s=void 0!==e?e.scrollY:0,n={left:o.offsetLeft-i+r,top:o.offsetTop-s+a};else n={left:0,top:0};if("touchmove"==t.type||"touchstart"==t.type){var l=void 0!==t.originalEvent.touches[0].force?t.originalEvent.touches[0].force:1;return void 0!==t.originalEvent.touches[0].touchType&&"stylus"==t.originalEvent.touches[0].touchType?this.pen_pressure=!0:this.pen_pressure=!1,0==l&&0==this.pen_pressure&&(l=1),{x:(t.originalEvent.touches[0].pageX-n.left)/this.zoomFactor,y:(t.originalEvent.touches[0].pageY-n.top)/this.zoomFactor,pressure:l}}return{x:(t.pageX-n.left)/this.zoomFactor,y:(t.pageY-n.top)/this.zoomFactor,pressure:1}},a.is_dragging=!1,a.bind_draw_events=function(){var o=this,e=o.getContext("2d",{alpha:o.settings.enable_tranparency});t(o).data("is_drawing",!1),t(o).data("lastx",null),t(o).data("lasty",null),t(o).parent().on("touchstart",function(t){t.preventDefault()}),t(window).on("touchstart mousedown",function(r){var i=t(o).parent()[0],s=o.offsetLeft,n=o.offsetTop,l=t(o).parent()[0].offsetWidth-parseInt(window.getComputedStyle(i,null).getPropertyValue("border-right-width"))-parseInt(window.getComputedStyle(i,null).getPropertyValue("border-left-width")),h=t(o).parent()[0].offsetHeight-parseInt(window.getComputedStyle(i,null).getPropertyValue("border-bottom-width"))-parseInt(window.getComputedStyle(i,null).getPropertyValue("border-top-width")),c=a.get_mouse_data.call(o,r);if(o.$brushToolbox.is(":visible")&&c.x*o.zoomFactor>s&&c.x*o.zoomFactor<s+l&&c.y*o.zoomFactor>n&&c.y*o.zoomFactor<n+h&&0==a.is_dragging){c=a.get_mouse_data.call(o,r,t(o).parent()[0],o),t(o).data("is_drawing",!0),e.lineCap="round",e.lineJoin="round";var u=o.brushAlpha;1==o.active_brush.pressure_affects_alpha&&(u*=2*c.pressure)>1&&(u=1);var d=o.active_brush.size;1==o.active_brush.pressure_affects_size&&(d*=2*c.pressure)<1&&(d=1),t(o).data("positions",[{x:c.x,y:c.y}]),void 0!==o.active_brush.drawStart&&o.active_brush.drawStart.call(o,o.active_brush,e,c.x,c.y,d,u,r),void 0!==o.active_brush.drawSpot&&o.active_brush.drawSpot.call(o,o.active_brush,e,c.x,c.y,d,u,r)}}).on("touchmove mousemove",function(r){var i=a.get_mouse_data.call(o,r,t(o).parent()[0],o);if(1==t(o).data("is_drawing")){var s=t(o).data("positions"),n={x:i.x,y:i.y},l=s[s.length-1],h=a.distance_between(l,n),c=a.angle_between(l,n),u=o.brushAlpha;1==o.active_brush.pressure_affects_alpha&&(u*=2*i.pressure)>1&&(u=1);var d=o.active_brush.size;1==o.active_brush.pressure_affects_size&&(d*=2*i.pressure)<1&&(d=1);var p=d/6;p<1&&(p=1);for(var f=p;f<h;f+=p)x=l.x+Math.sin(c)*f,y=l.y+Math.cos(c)*f,void 0!==o.active_brush.drawSpot&&o.active_brush.drawSpot.call(o,o.active_brush,e,x,y,d,u,r),s.push({x:x,y:y});t(o).data("positions",s)}i=a.get_mouse_data.call(o,r),t(".drawr-toolbox").each(function(){1==t(this).data("dragging")&&t(this).offset({top:(i.y-t(this).data("offsety"))*o.zoomFactor,left:(i.x-t(this).data("offsetx"))*o.zoomFactor})})}).on("touchend mouseup",function(r){if(1==t(o).data("is_drawing")){var i=a.get_mouse_data.call(o,r,o),s=o.brushAlpha;1==o.active_brush.pressure_affects_alpha&&(s*=2*i.pressure)>1&&(s=1);var n=o.active_brush.size;1==o.active_brush.pressure_affects_size&&(n*=2*i.pressure)<1&&(n=1);var l=void 0;void 0!==o.active_brush.drawStop&&(l=o.active_brush.drawStop.call(o,o.active_brush,e,i.x,i.y,n,s,r)),void 0!==l&&(o.$undoButton.css("opacity",1),o.undoStack.push({data:o.toDataURL("image/png"),current:!0}),o.undoStack.length>o.settings.undo_max_levels+1&&o.undoStack.shift())}t(o).data("is_drawing",!1).data("lastx",null).data("lasty",null),t(".drawr-toolbox").data("dragging",!1),a.is_dragging||"INPUT"!==r.target.tagName&&r.preventDefault(),a.is_dragging=!1})},a.select_button=function(o){this.getContext("2d",{alpha:this.settings.enable_tranparency});this.$brushToolbox.find("button.type-brush").each(function(){t(this).removeClass("active"),t(this).css({background:"#eeeeee",color:"#000000"})}),t(o).css({background:"orange",color:"white"}),t(o).addClass("active"),a.activate_brush.call(this,t(o).data("data"))},a.activate_brush=function(t){var o=this.getContext("2d",{alpha:this.settings.enable_tranparency});void 0!==this.active_brush&&void 0!==this.active_brush.deactivate&&this.active_brush.deactivate.call(this,this.active_brush,o),this.active_brush=t,this.brushSize=void 0!==t.size?t.size:this.brushSize,this.brushAlpha=void 0!==t.alpha?t.alpha:this.brushAlpha,void 0!==this.$colorToolbox&&this.$colorToolbox.find("input:first").val(100*this.brushAlpha).trigger("input"),void 0!==this.$colorToolbox&&this.$colorToolbox.find("input:last").val(this.brushSize).trigger("input"),this.active_brush.activate.call(this,this.active_brush,o)},a.create_button=function(o,e,r,i){var s=this,n=t("<button style='float:left;display:block;margin:0px;'><i class='"+r.icon+"'></i></button>");return n.css({outline:"none","text-align":"center",padding:"0px 0px 0px 0px",width:"50%",background:"#eeeeee",color:"#000000",border:"0px","min-height":"30px","user-select":"none","text-align":"center","border-radius":"0px"}),void 0!==i&&n.css(i),n.addClass("type-"+e),n.data("data",r).data("type",e),n.on("mousedown touchstart",function(o){"brush"==t(this).data("type")&&a.select_button.call(s,this),"toggle"==t(this).data("type")&&(void 0===t(this).data("state")&&t(this).data("state",!1),t(this).data("state",!t(this).data("state")),1==t(this).data("state")?t(this).css({background:"orange",color:"white"}):t(this).css({background:"#eeeeee",color:"#000000"})),o.stopPropagation(),o.preventDefault()}),t(o).append(n),n},a.create_slider=function(o,e,a,r,i){return t(o).append('<div style="clear:both;font-weight:bold;text-align:center;padding:5px 0px 5px 0px">'+e+'</div><div style="clear:both;display: inline-block;width: 50px;height: 60px;margin-top:5px;padding: 0;"><input value="'+i+'" style="background:transparent;width: 50px;height: 50px;margin: 0;transform-origin: 25px 25px;transform: rotate(90deg);" type="range" min="'+a+'" max="'+r+'" step="1" /><span>'+i+"</span></div>"),t(o).find("input:last").on("mousedown touchstart",function(t){t.stopPropagation()}).on("input",function(o){t(this).next().text(t(this).val())}),t(o).find("input:last")},a.initialize_canvas=function(o,e){t(this).css({display:"block","background-size":"20px 20px","user-select":"none","webkit-touch-callout":"none"}),t(this).parent().css({overflow:"hidden","user-select":"none","webkit-touch-callout":"none"}),1==this.settings.enable_tranparency&&t(this).css({"background-image":"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAAB3RJTUUH4wUIDDYyGYFdggAAAC5JREFUOMtjfPXqFQNuICoqikeWiYECMKp5ZGhm/P//Px7p169fjwbYqGZKNAMA5EEI4kUyPZcAAAAASUVORK5CYII=)"}),this.width=o,this.height=e,t(this).width(o),t(this).height(e),this.zoomFactor=1,this.brushColor={r:0,g:0,b:0},this.plugin=a,this.pen_pressure=!1,void 0!==this.$zoomToolbox&&this.$zoomToolbox.find("input").val(100).trigger("input"),a.apply_scroll.call(this,0,0,!1);var r=this.getContext("2d",{alpha:this.settings.enable_tranparency});0==this.settings.enable_tranparency?(r.fillStyle="white",r.fillRect(0,0,o,e)):r.clearRect(0,0,o,e),(r=this.$memoryCanvas[0].getContext("2d")).fillStyle="blue",r.fillRect(0,0,o,e);var i=t(this).parent().innerWidth(),s=t(this).parent().innerHeight(),n=parseInt(window.getComputedStyle(t(this).parent()[0],null).getPropertyValue("border-top-width")),l=parseInt(window.getComputedStyle(t(this).parent()[0],null).getPropertyValue("border-left-width"));this.$memoryCanvas.css({"z-index":5,position:"absolute",width:i,height:s,top:t(this).parent().offset().top+n+"px",left:t(this).parent().offset().left+l+"px"}),this.$memoryCanvas[0].width=i,this.$memoryCanvas[0].height=s,this.$memoryCanvas.width(i),this.$memoryCanvas.height(s),window.requestAnimationFrame(a.draw_animations.bind(this))},a.draw_animations=function(){var o=this.$memoryCanvas[0].getContext("2d");o.clearRect(0,0,this.$memoryCanvas[0].width,this.$memoryCanvas[0].height),void 0!==this.effectCallback&&null!==this.effectCallback&&this.effectCallback.call(this,o,this.active_brush,this.scrollX,this.scrollY,this.zoomFactor);var e=t(this).parent().width(),r=t(this).parent().height();if(o.globalAlpha=.5,o.lineWidth=1,o.lineJoin=o.lineCap="round",o.strokeStyle="black",o.beginPath(),o.moveTo(0,-1-this.scrollY),o.lineTo(this.width,-1-this.scrollY),o.stroke(),o.beginPath(),o.moveTo(0,this.height*this.zoomFactor-this.scrollY),o.lineTo(this.width,this.height*this.zoomFactor-this.scrollY),o.stroke(),o.beginPath(),o.moveTo(-1-this.scrollX,0),o.lineTo(-1-this.scrollX,this.height),o.stroke(),o.beginPath(),o.moveTo(this.width*this.zoomFactor-this.scrollX,0),o.lineTo(this.width*this.zoomFactor-this.scrollX,this.height),o.stroke(),this.scrollTimer>0){o.globalAlpha=.006*this.scrollTimer<1?.006*this.scrollTimer:.6,this.scrollTimer-=5,o.lineWidth=4,o.lineCap="square",o.beginPath();var i=e,s=e;this.scrollX<0&&(s+=this.scrollX),this.scrollX>this.width*this.zoomFactor-e&&(s-=this.scrollX-(this.width*this.zoomFactor-e)),s<0&&(s=0);var n=i/100*(100/this.width*s);(n/=this.zoomFactor)<1&&(n=1);var l=(i-n)/100*(100/(this.width*this.zoomFactor-e)*this.scrollX);l<0&&(l=0),l>e-n&&(l=e-n),o.moveTo(l,r-3),o.lineTo(l+n,r-3),o.stroke();var h=r,c=r;this.scrollY<0&&(c+=this.scrollY),this.scrollY>this.height*this.zoomFactor-r&&(c-=this.scrollY-(this.height*this.zoomFactor-r)),c<0&&(c=0);var u=h/100*(100/(this.height*this.zoomFactor)*c);u<1&&(u=1);var d=(h-u)/100*(100/(this.width*this.zoomFactor-r)*this.scrollY);d<0&&(d=0),d>r-u&&(d=r-u),o.moveTo(e-2,d),o.lineTo(e-2,d+u),o.stroke()}window.requestAnimationFrame(a.draw_animations.bind(this))},a.create_toolbox=function(o,e,r){var i=document.createElement("div");return i.innerHTML="<div style='padding:5px 0px 5px 0px'>"+r+"</div>",i.className="drawr-toolbox drawr-toolbox-"+o,i.ownerCanvas=this,t(i).css({position:"absolute","z-index":6,cursor:"move",width:"80px",height:"auto",color:"#fff",padding:"2px",background:"linear-gradient(to bottom, rgba(69,72,77,1) 0%,rgba(0,0,0,1) 100%)","border-radius":"2px","box-shadow":"0px 2px 5px -2px rgba(0,0,0,0.75)","user-select":"none","font-family":"sans-serif","font-size":"12px","text-align":"center"}),t(i).insertAfter(t(this).parent()),t(i).offset(e),t(i).hide(),t(i).on("mousedown touchstart",function(o){var e=this.ownerCanvas,r=a.get_mouse_data.call(e,o,this);t(this).data("offsetx",r.x).data("offsety",r.y).data("dragging",!0),a.is_dragging=!0,o.preventDefault()}),t(i)},a.apply_scroll=function(o,e,a){t(this).css("transform","translate("+-o+"px,"+-e+"px)"),this.scrollX=o,this.scrollY=e,1==a&&(this.scrollTimer=250)},"export"==o){var r=this.first()[0],i=void 0===e?"image/png":e;return r.toDataURL(i)}if("button"==o){var s=t();return this.each(function(){var t=a.create_button.call(this,this.$brushToolbox[0],"action",e);s=s.add(t)}),s}return this.each(function(){var r=this;if("start"===o)t(".drawr-toolbox").hide(),t(".drawr-toolbox-brush").show(),r.$brushToolbox.find("button:first").mousedown();else if("stop"===o)r.$brushToolbox.find("button.type-toggle").each(function(){1==t(this).data("state")&&t(this).trigger("mousedown")}),t(".drawr-toolbox").hide();else if("load"===o){var i=document.createElement("img");i.crossOrigin="Anonymous",i.onload=function(){var t=r.getContext("2d",{alpha:r.settings.enable_tranparency});a.initialize_canvas.call(r,i.width,i.height),r.undoStack=[{data:r.toDataURL("image/png"),current:!0}],t.drawImage(i,0,0)},i.src=e}else if("destroy"===o)alert("unimplemented");else if("object"==typeof o||void 0===o){if(t(r).hasClass("active-drawr"))return!1;r.className=r.className+" active-drawr",t(r).parent().addClass("drawr-container");var s={enable_tranparency:!0,canvas_width:t(r).parent().innerWidth(),canvas_height:t(r).parent().innerHeight(),undo_max_levels:5};"object"==typeof o&&(s=Object.assign(s,o)),r.settings=s,r.$memoryCanvas=t("<canvas class='sfx-canvas'></canvas>"),r.$memoryCanvas.insertBefore(r),a.initialize_canvas.call(r,s.canvas_width,s.canvas_height),r.undoStack=[{data:r.toDataURL("image/png"),current:!0}];var n=r.getContext("2d",{alpha:s.enable_tranparency});r.$brushToolbox=a.create_toolbox.call(r,"brush",{left:t(r).parent().offset().left,top:t(r).parent().offset().top},"Brushes"),t.fn.drawr.availableBrushes.sort(function(t,o){return t.order>o.order?1:o.order>t.order?-1:0}),t.each(t.fn.drawr.availableBrushes,function(t,o){a.create_button.call(r,r.$brushToolbox[0],"brush",o)}),a.create_button.call(r,r.$brushToolbox[0],"toggle",{icon:"mdi mdi-palette-outline mdi-24px"}).on("touchstart mousedown",function(){r.$colorToolbox.toggle()}),a.create_button.call(r,r.$brushToolbox[0],"toggle",{icon:"mdi mdi-magnify mdi-24px"}).on("touchstart mousedown",function(){r.$zoomToolbox.toggle()}),r.$undoButton=a.create_button.call(r,r.$brushToolbox[0],"action",{icon:"mdi mdi-undo-variant mdi-24px"}).on("touchstart mousedown",function(){if(r.undoStack.length>0){if(1==r.undoStack[r.undoStack.length-1].current&&r.undoStack.pop(),t.each(r.undoStack,function(t,o){o.current=!1}),0==r.undoStack.length)return;var o=r.undoStack.pop().data,e=document.createElement("img");e.crossOrigin="Anonymous",e.onload=function(){r.plugin.initialize_canvas.call(r,e.width,e.height),n.drawImage(e,0,0)},e.src=o,0==r.undoStack.length&&(r.$undoButton.css("opacity",.5),r.undoStack.push({data:o,current:!1}))}}),r.$undoButton.css("opacity",.5),r.$colorToolbox=a.create_toolbox.call(r,"color",{left:t(r).parent().offset().left+t(r).parent().innerWidth()-80,top:t(r).parent().offset().top},"Color");t.each(["#FFFFFF","#0074D9","#2ECC40","#FFDC00","#FF4136","#111111"],function(t,o){a.create_button.call(r,r.$colorToolbox[0],"color",{icon:""},{background:o}).on("touchstart mousedown",function(){r.brushColor=a.hex_to_rgb(o),void 0!==r.active_brush.activate&&r.active_brush.activate.call(r,r.active_brush,n),a.is_dragging=!1})}),a.create_slider.call(r,r.$colorToolbox,"alpha",0,100,parseInt(100*s.inital_brush_alpha)).on("input",function(){r.brushAlpha=parseFloat(this.value/100),r.active_brush.alpha=parseFloat(this.value/100),a.is_dragging=!1}),a.create_slider.call(r,r.$colorToolbox,"size",2,100,s.inital_brush_size).on("input",function(){r.brushSize=this.value,r.active_brush.size=this.value,a.is_dragging=!1}),r.$zoomToolbox=a.create_toolbox.call(r,"zoom",{left:t(r).parent().offset().left+t(r).parent().innerWidth()-80,top:t(r).parent().offset().top},"Zoom"),a.create_slider.call(r,r.$zoomToolbox,"zoom",0,400,100).on("input",function(){var o=10*Math.ceil(this.value/10);t(this).next().text(o);var e=.01*o,i=e-r.zoomFactor+1;r.zoomFactor=e,t(r).width(r.width*e),t(r).height(r.height*e),t(r).css({"background-size":20*e+"px "+20*e+"px "}),1!==i&&a.apply_scroll.call(r,r.scrollX*i,r.scrollY*i,!0)}),a.bind_draw_events.call(r)}}),this},t.fn.drawr.register=function(o){void 0===t.fn.drawr.availableBrushes&&(t.fn.drawr.availableBrushes=[]),t.fn.drawr.availableBrushes.push(o)}}(jQuery),jQuery.fn.drawr.register({icon:"mdi mdi-spray mdi-24px",name:"airbrush",size:40,alpha:.2,order:3,pressure_affects_alpha:!0,pressure_affects_size:!1,activate:function(t,o){},deactivate:function(t,o){},drawStart:function(t,o,e,a,r,i,s){o.globalCompositeOperation="source-over",o.globalAlpha=i},drawSpot:function(t,o,e,a,r,i,s){o.globalAlpha=i;var n=o.createRadialGradient(e,a,0,e,a,this.brushSize/2);n.addColorStop(0,"rgb("+this.brushColor.r+","+this.brushColor.g+","+this.brushColor.b+")"),n.addColorStop(.5,"rgba("+this.brushColor.r+","+this.brushColor.g+","+this.brushColor.b+",0.5)"),n.addColorStop(1,"rgba("+this.brushColor.r+","+this.brushColor.g+","+this.brushColor.b+",0)"),o.fillStyle=n,o.fillRect(e-this.brushSize/2,a-this.brushSize/2,this.brushSize,this.brushSize)},drawStop:function(t,o,e,a,r,i,s){return!0}}),jQuery.fn.drawr.register({icon:"mdi mdi-brush mdi-24px",name:"pen",size:6,alpha:.5,order:4,pressure_affects_alpha:!0,pressure_affects_size:!0,activate:function(t,o){},deactivate:function(t,o){},drawStart:function(t,o,e,a,r,i,s){o.globalCompositeOperation="source-over",o.globalAlpha=i},drawSpot:function(t,o,e,a,r,i,s){o.globalAlpha=i;var n=o.createRadialGradient(e,a,0,e,a,r/2);n.addColorStop(0,"rgb("+this.brushColor.r+","+this.brushColor.g+","+this.brushColor.b+")"),n.addColorStop(.5,"rgba("+this.brushColor.r+","+this.brushColor.g+","+this.brushColor.b+",0.5)"),n.addColorStop(1,"rgba("+this.brushColor.r+","+this.brushColor.g+","+this.brushColor.b+",0)"),o.fillStyle=n,o.fillRect(e-r/2,a-r/2,r,r)},drawStop:function(t,o,e,a,r,i,s){return!0}}),jQuery.fn.drawr.register({icon:"mdi mdi-eraser mdi-24px",name:"eraser",size:10,alpha:.8,order:5,pressure_affects_alpha:!0,pressure_affects_size:!0,activate:function(t,o){},deactivate:function(t,o){},drawStart:function(t,o,e,a,r,i,s){1==this.settings.enable_tranparency?o.globalCompositeOperation="destination-out":o.globalCompositeOperation="source-over",o.globalAlpha=i},drawSpot:function(t,o,e,a,r,i,s){if(o.globalAlpha=i,1==this.settings.enable_tranparency){var n=o.createRadialGradient(e,a,0,e,a,r/2);n.addColorStop(0,"#000"),n.addColorStop(.5,"rgba(0,0,0,0.5)"),n.addColorStop(1,"rgba(0,0,0,0)"),o.fillStyle=n,o.fillRect(e-r/2,a-r/2,r,r)}else o.fillStyle="white",o.beginPath(),o.arc(e,a,r/2,0,2*Math.PI),o.fill()},drawStop:function(t,o,e,a,r,i,s){return!0}}),jQuery.fn.drawr.register({icon:"mdi mdi-eyedropper mdi-24px",name:"pen",order:6,activate:function(t,o){},deactivate:function(t,o){},drawStart:function(t,o,e,a,r){},drawSpot:function(t,o,e,a,r,i){var s=o.getImageData(e,a,1,1).data;this.brushColor={r:s[0],g:s[1],b:s[2]}}}),jQuery.fn.drawr.register({icon:"mdi mdi-square mdi-24px",name:"filledsquare",size:3,alpha:1,order:8,pressure_affects_alpha:!1,pressure_affects_size:!1,activate:function(t,o){},deactivate:function(t,o){},drawStart:function(t,o,e,a,r,i,s){t.currentAlpha=i,t.startPosition={x:e,y:a},this.effectCallback=t.effectCallback,o.globalAlpha=i,o.lineWidth=r},drawStop:function(t,o,e,a,r,i,s){return o.globalAlpha=i,o.lineJoin="miter",o.lineWidth=r,o.fillStyle="rgb("+this.brushColor.r+","+this.brushColor.g+","+this.brushColor.b+")",o.fillRect(t.startPosition.x,t.startPosition.y,t.currentPosition.x-t.startPosition.x,t.currentPosition.y-t.startPosition.y),this.effectCallback=null,!0},drawSpot:function(t,o,e,a,r,i,s){t.currentPosition={x:e,y:a}},effectCallback:function(t,o,e,a,r){t.globalAlpha=o.currentAlpha,t.lineJoin="miter",t.fillStyle="rgb("+this.brushColor.r+","+this.brushColor.g+","+this.brushColor.b+")",t.fillRect(o.startPosition.x*r-e,o.startPosition.y*r-a,(o.currentPosition.x-o.startPosition.x)*r,(o.currentPosition.y-o.startPosition.y)*r)}}),jQuery.fn.drawr.register({icon:"mdi mdi-marker mdi-24px",name:"marker",size:15,alpha:.3,order:10,pressure_affects_alpha:!1,pressure_affects_size:!1,activate:function(t,o){},deactivate:function(t,o){},drawStart:function(t,o,e,a,r,i,s){o.globalCompositeOperation="source-over",t.currentAlpha=i,t.startPosition={x:e,y:a},this.effectCallback=t.effectCallback},drawStop:function(t,o,e,a,r,i,s){o.globalAlpha=i,t.currentSize=r,t.currentAlpha=i,this.effectCallback=null,o.lineWidth=r,o.lineJoin=o.lineCap="round",o.strokeStyle="rgb("+this.brushColor.r+","+this.brushColor.g+","+this.brushColor.b+")",o.beginPath();var n=$(this).data("positions");return $.each(n,function(t,e){t>0&&(o.moveTo(n[t-1].x,n[t-1].y),o.lineTo(e.x,e.y))}),o.stroke(),!0},drawSpot:function(t,o,e,a,r,i,s){t.currentSize=r,t.currentAlpha=i,t.currentPosition={x:e,y:a}},effectCallback:function(t,o,e,a,r){t.globalAlpha=o.currentAlpha,t.lineWidth=o.currentSize*r,t.lineJoin=t.lineCap="round",t.strokeStyle="rgb("+this.brushColor.r+","+this.brushColor.g+","+this.brushColor.b+")",t.beginPath();var i=$(this).data("positions");$.each(i,function(o,s){o>0&&(t.moveTo(i[o-1].x*r-e,i[o-1].y*r-a),t.lineTo(s.x*r-e,s.y*r-a))}),t.stroke()}}),jQuery.fn.drawr.register({icon:"mdi mdi-cursor-move mdi-24px",name:"move",order:9,activate:function(t,o){$(this).parent().css({cursor:"move"})},deactivate:function(t,o){$(this).parent().css({cursor:"default"})},drawStart:function(t,o,e,a,r,i,s){o.globalCompositeOperation="source-over",t.dragStartX=null,t.scrollStartX=null,t.dragStartY=null,t.scrollStartY=null,"touchmove"==s.type||"touchstart"==s.type?(e=s.originalEvent.touches[0].pageX,Y=s.originalEvent.touches[0].pageY):(e=s.pageX,a=s.pageY),t.dragStartX=e,t.scrollStartX=this.scrollX,t.dragStartY=a,t.scrollStartY=this.scrollY},drawSpot:function(t,o,e,a,r,i,s){"touchmove"==s.type||"touchstart"==s.type?(e=s.originalEvent.touches[0].pageX,Y=s.originalEvent.touches[0].pageY):(e=s.pageX,a=s.pageY);var n=parseInt(-(e-t.dragStartX)),l=parseInt(-(a-t.dragStartY));this.plugin.apply_scroll.call(this,t.scrollStartX+n,t.scrollStartY+l,!0)}}),jQuery.fn.drawr.register({icon:"mdi mdi-fountain-pen-tip mdi-24px",name:"pen",size:3,alpha:1,order:2,pressure_affects_alpha:!1,pressure_affects_size:!0,activate:function(t,o){},deactivate:function(t,o){},drawStart:function(t,o,e,a,r,i,s){o.globalCompositeOperation="source-over",o.globalAlpha=i},drawSpot:function(t,o,e,a,r,i,s){o.globalAlpha=i,o.fillStyle="rgb("+this.brushColor.r+","+this.brushColor.g+","+this.brushColor.b+")",o.beginPath(),o.arc(e,a,r/2,0,2*Math.PI),o.fill()},drawStop:function(t,o,e,a,r,i,s){return!0}}),jQuery.fn.drawr.register({icon:"mdi mdi-lead-pencil mdi-24px",name:"pencil",size:5,alpha:.8,order:1,pressure_affects_alpha:!0,pressure_affects_size:!1,activate:function(t,o){var e=this;t.brushImage=new Image,t.brushImage.crossOrigin="Anonymous",t.brushImage.onload=function(){var o=document.createElement("canvas"),a=o.getContext("2d");o.width=t.brushImage.width,o.height=t.brushImage.height,a.fillStyle="rgb("+e.brushColor.r+","+e.brushColor.g+","+e.brushColor.b+")",a.fillRect(0,0,o.width,o.height),a.globalCompositeOperation="destination-atop",a.drawImage(t.brushImage,0,0),t.brushImage=o},t.brushImage.src="images/lead-pencil.png"},deactivate:function(t,o){},drawStart:function(t,o,e,a,r,i,s){o.globalCompositeOperation="source-over",o.globalAlpha=i},drawRotatedImage:function(t,o,e,a,r,i){t.save(),t.translate(e,a);var s=360*Math.random()+1;if(t.rotate(s*Math.PI/180),o.width>=o.height)var n=o.height/(o.width/i),l=i;else l=o.width/(o.height/i),n=i;var h=-l/2,c=-n/2;t.drawImage(o,h,c,l,n),t.restore()},drawSpot:function(t,o,e,a,r,i,s){o.globalAlpha=i,t.drawRotatedImage(o,t.brushImage,e,a,0,r)},drawStop:function(t,o,e,a,r,i,s){return!0}}),jQuery.fn.drawr.register({icon:"mdi mdi-vector-square mdi-24px",name:"square",size:3,alpha:1,order:7,pressure_affects_alpha:!1,pressure_affects_size:!1,activate:function(t,o){},deactivate:function(t,o){},drawStart:function(t,o,e,a,r,i,s){o.globalCompositeOperation="source-over",t.currentAlpha=i,t.currentSize=r,t.startPosition={x:e,y:a},this.effectCallback=t.effectCallback,o.globalAlpha=i},drawStop:function(t,o,e,a,r,i,s){return o.globalAlpha=i,o.lineJoin="miter",o.lineWidth=r,o.strokeStyle="rgb("+this.brushColor.r+","+this.brushColor.g+","+this.brushColor.b+")",o.strokeRect(t.startPosition.x,t.startPosition.y,t.currentPosition.x-t.startPosition.x,t.currentPosition.y-t.startPosition.y),this.effectCallback=null,!0},drawSpot:function(t,o,e,a,r,i,s){t.currentPosition={x:e,y:a}},effectCallback:function(t,o,e,a,r){t.globalAlpha=o.currentAlpha,t.lineWidth=o.currentSize*r,t.lineJoin="miter",t.strokeStyle="rgb("+this.brushColor.r+","+this.brushColor.g+","+this.brushColor.b+")",t.strokeRect(o.startPosition.x*r-e,o.startPosition.y*r-a,(o.currentPosition.x-o.startPosition.x)*r,(o.currentPosition.y-o.startPosition.y)*r)}}),jQuery.fn.drawr.register({icon:"mdi mdi-format-text mdi-24px",name:"text",size:22,alpha:1,order:22,pressure_affects_alpha:!1,pressure_affects_size:!1,activate:function(t,o){},deactivate:function(t,o){void 0!==t.$floatyBox&&(t.$floatyBox.remove(),delete t.$floatyBox)},drawStart:function(t,o,e,a,r,i,s){var n=this;if(t.currentPosition={x:e,y:a},o.globalAlpha=i,void 0===t.$floatyBox){var l=parseInt(20*n.zoomFactor);t.$floatyBox=$('<div style="z-index:6;position:absolute;width:100px;height:20px;"><input style="background:transparent;border:0px;padding:0px;font-size:'+l+'px;font-family:sans-serif;" type="text" value=""><button class="ok"><i class="mdi mdi-check"></i></button><button class="cancel"><i class="mdi mdi-close"></i></button></div>'),$(t.$floatyBox).insertAfter($(this).parent()),t.$floatyBox.css({left:$(this).parent().offset().left+e*n.zoomFactor-this.scrollX,top:$(this).parent().offset().top+a*n.zoomFactor-this.scrollY}),t.$floatyBox.find("input").on("mousedown touchstart",function(o){o.preventDefault(),o.stopPropagation(),t.$floatyBox.find("input").focus()}),t.$floatyBox.find("input").focus(),s.preventDefault(),s.stopPropagation(),t.$floatyBox.find(".ok").on("mousedown touchstart",function(e){e.preventDefault(),e.stopPropagation(),t.applyText.call(n,o,t,t.currentPosition.x,t.currentPosition.y,t.$floatyBox.find("input").val()),t.$floatyBox.remove(),delete t.$floatyBox}),t.$floatyBox.find(".cancel").on("mousedown touchstart",function(o){o.preventDefault(),o.stopPropagation(),t.$floatyBox.remove(),delete t.$floatyBox})}else t.$floatyBox.css({left:$(this).parent().offset().left+e*n.zoomFactor-this.scrollX,top:$(this).parent().offset().top+a*n.zoomFactor-this.scrollY})},applyText:function(t,o,e,a,r){t.font="20px sans-serif",t.textAlign="left",t.fillStyle="rgb("+this.brushColor.r+","+this.brushColor.g+","+this.brushColor.b+")",t.fillText(r,e-2,a+19)},drawStop:function(t,o,e,a,r,i,s){return!0},drawSpot:function(t,o,e,a,r,i,s){t.currentPosition={x:e,y:a},void 0===t.$floatyBox||t.$floatyBox.css({left:$(this).parent().offset().left+e*this.zoomFactor-this.scrollX,top:$(this).parent().offset().top+a*this.zoomFactor-this.scrollY})}});